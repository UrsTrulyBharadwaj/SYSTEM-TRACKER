
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hunter System V2.0 - RPG Habit Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    :root { --neon: #21e6c1; --neon2: #64fff0; --neon-blue: #51e7ff; --bg: #131d2d; --panel: #1c2331;}
    body { background: var(--bg); font-family: "Roboto Mono", monospace; }
    .glass { background: rgba(27,36,54,0.96); backdrop-filter: blur(11px);}
    .border-neon { border-color: var(--neon2);}
    .neon-glow {
      box-shadow: 0 0 0 2px var(--neon2), 0 4px 18px 0 var(--neon-blue);
    }
    .tab, .tab-active {
      padding: 0.8em 1.6em;
      font-weight: bold;
      border-radius: 6px 6px 0 0;
      margin-right: 5px;
      background: transparent;
      border: 0;
      outline: 0;
    }
    .tab-active {
      background: var(--panel);
      color: var(--neon-blue);
      box-shadow: 0 2px 0 0 var(--neon-blue) inset;
      border-bottom: 0 !important;
    }
    .tab:not(.tab-active):hover { color: var(--neon-blue);}
    .btn-action {background: var(--neon2); color: #112030; box-shadow: 0 1px 16px 1px #64fff055;}
    .btn-action:hover {background: var(--neon-blue);}
    .text-neon {color: var(--neon2);}
    .text-mana {color: var(--neon);}
    .input-box {background: #202a3d !important;}
  </style>
  <script>
    window.firebaseConfig = null; // paste your config if using Firestore for sync, else leave null
  </script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    // Util
    const todayISO = () => new Date().toISOString().split('T')[0];
    const uid = () => Math.random().toString(36).slice(2,10);
    const STORAGE = "hunter_system_v2";

    // Local state
    const LocalProvider = {
      load: async () => {
        const raw = localStorage.getItem(STORAGE);
        if(!raw) {
          const init = {profile:{name: "Hunter", xp: 0, level: 1}, habits: [], rewards: []};
          localStorage.setItem(STORAGE, JSON.stringify(init));
          return init;
        }
        return JSON.parse(raw);
      },
      save: async (s) => localStorage.setItem(STORAGE, JSON.stringify(s))
    };

    // XP logic
    const gainXP = streak => streak >= 3 ? 15 : 10;
    const recomputeLevel = xp => 1 + Math.floor(xp / 100);

    // ------------- MODALS -------------
    function SettingsModal({profile,onSave,onClose}) {
      const [name, setName] = React.useState(profile?.name || "");
      return (
        <div className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50">
          <div className="glass border-2 border-neon neon-glow p-8 rounded-lg min-w-[300px] shadow-2xl w-full max-w-sm">
            <div className="flex justify-between items-center">
              <h3 className="text-xl font-bold text-neon mb-4">SYSTEM SETTINGS</h3>
              <button onClick={onClose} className="text-gray-400">&times;</button>
            </div>
            <div className="mt-2 mb-5">
              <p className="text-gray-300 mb-2">Set your <b>Hunter Display Name</b> for the greeting.</p>
              <input value={name} onChange={e=>setName(e.target.value)}
                type="text" placeholder="e.g., Sung Jin-Woo"
                className="w-full p-3 rounded input-box border-2 border-neon text-white focus:outline-none focus:border-neon mb-6"/>
              <button className="btn-action w-full rounded p-2" onClick={()=>onSave(name)}>Save & Continue</button>
            </div>
          </div>
        </div>
      );
    }

    function CreateHabitModal({onSave,onClose}) {
      const [name, setName] = React.useState("");
      const [reward, setReward] = React.useState("");
      return (
        <div className="fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50">
          <div className="glass border-2 border-neon neon-glow p-8 rounded-lg max-w-lg w-full shadow-2xl">
            <h3 className="text-xl font-bold text-neon mb-4">CREATE NEW QUEST</h3>
            <div className="mb-4 space-y-2">
              <input type="text" value={name} onChange={e=>setName(e.target.value)} autoFocus
                placeholder="Quest Name (e.g., Meditate 10 mins)" className="w-full p-3 rounded input-box border-2 border-neon text-white focus:outline-none"/>
              <input type="text" value={reward} onChange={e=>setReward(e.target.value)}
                placeholder="7-Day Reward (e.g., Biryani Pass Unlocked!)" className="w-full p-3 rounded input-box border-2 border-neon text-white focus:outline-none"/>
            </div>
            <div className="flex justify-end mt-6 gap-3">
              <button className="px-5 py-2 rounded text-gray-400 border border-gray-700 transition" onClick={onClose}>Cancel</button>
              <button className="btn-action px-5 py-2 rounded" onClick={()=>{if(name)onSave({name,rewardDescription:reward})}}>Activate Quest</button>
            </div>
          </div>
        </div>
      );
    }

    // ------------- MAIN APP -------------
    function App() {
      const [state,setState] = React.useState(null);
      const [modal,setModal] = React.useState(null);

      React.useEffect(()=>{
        LocalProvider.load().then(setState);
      },[]);

      // Settings
      const saveName = (name) => {
        const next = {...state, profile:{...state.profile, name}};
        setState(next);
        LocalProvider.save(next);
        setModal(null);
      };

      // Add habit
      const addHabit = ({name,rewardDescription}) => {
        if(!name) return;
        const next = structuredClone(state);
        next.habits.push({id: uid(), name, logs:[], streak:0, rewardDescription});
        setState(next);
        LocalProvider.save(next);
        setModal(null);
      };

      // Claim quest today
      const toggleHabit = (hid) => {
        const t = todayISO();
        const next = structuredClone(state);
        const h = next.habits.find(x=>x.id===hid); if(!h) return;
        const done = h.logs.includes(t);
        if(done) h.logs = h.logs.filter(x=>x!==t);
        else {
          h.logs.push(t);
          let streak=0, days=new Set(h.logs);
          for(let i=0;;i++){const d=new Date(); d.setDate(d.getDate()-i);
            const iso=d.toISOString().slice(0,10);if(days.has(iso))streak++;else break;}
          h.streak=streak;
          next.profile.xp += gainXP(streak);
          next.profile.level = recomputeLevel(next.profile.xp);
        }
        setState(next);
        LocalProvider.save(next);
      };

      // UI render
      if(!state) return (
        <div className="min-h-screen flex items-center justify-center text-slate-100">
          <div className="text-center">
            <div className="mx-auto mb-6 h-10 w-10 rounded-full border-4 border-cyan-400/30 border-t-cyan-400 animate-spin"></div>
            <div className="text-neon text-lg">SYSTEM INITIALIZINGâ€¦</div>
          </div>
        </div>
      );

      return (
        <div className="min-h-screen" style={{background:"linear-gradient(120deg,#161f31 60%,#202a40 100%)"}}>
          <header className="p-4 shadow bg-[#171f2c] sticky top-0 z-10 border-b border-slate-800">
            <div className="max-w-3xl mx-auto flex justify-between items-center">
              <h1 className="text-2xl font-extrabold tracking-widest text-neon">HUNTER SYSTEM V2.0</h1>
              <div className="flex items-center gap-3">
                <span className="text-xs text-slate-400">USER: {state.profile.name || "Hunter"}</span>
                <button className="text-gray-400 hover:text-neon transition" aria-label="Settings" onClick={()=>setModal("settings")}>
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" strokeWidth="2"
                    viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15A1.65 1.65 0 0 0 21 13.35c0-1.08-1-2-2-2.35V7C19 5.89 18.11 5 17 5h-2.35c-.35-1-.8-2-1.35-2.65A1.65 1.65 0 0 0 13.35 3H11C9.89 3 9 3.89 9 5v2.35c-1 .35-2 1.27-2 2.35 0 1.08 1 2 2 2.35V17c0 1.11.89 2 2 2h2.35c.35 1 .8 2 1.35 2.65A1.65 1.65 0 0 0 13.35 21H11c-1.11 0-2-.89-2-2v-2.35c-1-.35-2-1.27-2-2.35z"></path></svg>
                </button>
              </div>
            </div>
          </header>
          <main className="max-w-3xl mx-auto pb-10 pt-6">
            {/* Tabs */}
            <div className="flex justify-center mb-2 border-b border-slate-800">
              {["STATUS WINDOW", "DAILY QUESTS", "REWARDS INVENTORY"].map(tabLabel=>
                <button key={tabLabel} className={window.activeTab===tabLabel?"tab tab-active":"tab"}
                        onClick={()=>{window.activeTab=tabLabel;window.dispatchEvent(new Event('tab'))}}>
                  {tabLabel}
                </button>
              )}
            </div>
            {/* Tab contents */}
            <TabContent state={state} setState={setState} setModal={setModal} toggleHabit={toggleHabit}/>
          </main>
          {modal==="settings" && <SettingsModal profile={state.profile} onSave={saveName} onClose={()=>setModal(null)}/>}
          {modal==="create" && <CreateHabitModal onSave={addHabit} onClose={()=>setModal(null)}/>}
        </div>
      );
    }

    // All Tabs
    function TabContent({state, setState, setModal, toggleHabit}) {
      const [tab,setTab] = React.useState(window.activeTab || "STATUS WINDOW");
      React.useEffect(()=>{
        const handler = () => setTab(window.activeTab);
        window.addEventListener('tab',handler);
        return ()=>window.removeEventListener('tab',handler);
      },[]);

      if(tab==="STATUS WINDOW") {
        return (
          <section className="glass neon-glow border-neon border-2 rounded-xl mt-6 p-8 shadow-2xl">
            <div className="mb-2 text-base text-neon font-bold">SYSTEM ALERT</div>
            <div className="text-2xl font-bold text-white mb-6">
              {(() => {
                const h=new Date().getHours();
                const t=h<12?"Good Morning":h<18?"Good Afternoon":"Good Evening";
                return `${t}, Hunter ${state.profile.name || "Hunter"}!`;
              })()}
            </div>
            <div>
              <div className="mb-5">
                <span className="block text-lg font-extrabold text-neon mb-1">LEVEL {state.profile.level}</span>
                <span className="block text-xs text-gray-400">XP: {state.profile.xp} / {100 * state.profile.level}</span>
                <div className="h-2 mt-1 bg-[#212a35] rounded-full">
                  <div className="h-full rounded-full bg-gradient-to-r from-[#51e7ff] to-[#19c497] transition-all"
                       style={{width: `${Math.min(100, (state.profile.xp % 100))}%`}}></div>
                </div>
              </div>
              <div className="flex gap-5 text-xs">
                <div className="p-3 rounded-xl bg-[#1c2741] text-mana">MANA / FOCUS: <b>100%</b></div>
                <div className="p-3 rounded-xl bg-[#1c2741] text-neon">{state.habits.filter(q=>q.logs.includes(todayISO())).length} QUESTS COMPLETED</div>
              </div>
            </div>
          </section>
        );
      }
      if(tab==="DAILY QUESTS") {
        return (
          <section className="mt-7">
            <button className="btn-action px-5 py-2 rounded mb-6 float-right" onClick={()=>setModal("create")}>CREATE NEW QUEST</button>
            <div className="clear-both"></div>
            <div className="grid gap-6">
              {state.habits.length===0 && <div className="glass p-8 text-neon border-2 border-neon rounded-xl text-center mt-2">No Quests yet. Create your first one!</div>}
              {state.habits.map(h=>(
                <div key={h.id} className="glass border-2 border-neon px-8 py-5 rounded-xl flex flex-col md:flex-row items-start md:items-center gap-5 shadow-lg">
                  <div>
                    <div className="text-lg font-bold text-white">{h.name}</div>
                    {h.rewardDescription && <div className="text-xs text-neon mb-3">Reward: {h.rewardDescription}</div>}
                  </div>
                  <button
                    className={`btn-action px-6 py-2 rounded-full ml-auto mt-2 md:mt-0 ${h.logs.includes(todayISO()) ? "opacity-60 cursor-not-allowed" : ""}`}
                    onClick={()=>toggleHabit(h.id)} disabled={h.logs.includes(todayISO())}
                  >
                    {h.logs.includes(todayISO()) ? "DONE!" : "CLAIM EXP"}
                  </button>
                  <div className="text-xs text-slate-400 ml-5 hidden md:block">Streak: {h.streak||0}</div>
                </div>
              ))}
            </div>
          </section>
        );
      }
      if(tab==="REWARDS INVENTORY") {
        return (
          <section className="mt-7">
            <h3 className="text-lg font-bold text-neon mb-4">EARNED REWARDS</h3>
            <ul className="space-y-3">
              {state.habits.filter(h=>(h.streak && h.streak>=7) && h.rewardDescription).map(h=>
                <li className="glass border-2 border-neon px-6 py-4 rounded-xl flex justify-between items-center">
                  <div>
                    <div className="font-bold text-neon">{h.rewardDescription}</div>
                    <div className="text-xs text-slate-400">Quest: {h.name}</div>
                  </div>
                  <span className="inline-block rounded-full px-3 py-1 bg-[#182a29] text-mana font-semibold">Claimable <span className="font-mono">{h.streak}</span> Streak</span>
                </li>
              )}
              {state.habits.filter(h=>h.streak<7 || !h.rewardDescription).length===state.habits.length &&
                <li className="glass p-8 text-slate-400 border-2 border-slate-700 rounded-xl text-center">Complete 7-day streaks with a reward to see inventory!</li>
              }
            </ul>
          </section>
        );
      }
      return null;
    }

    window.activeTab = "STATUS WINDOW";
    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
