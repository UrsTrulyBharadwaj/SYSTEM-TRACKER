<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hunter System V2.0 – RPG Daily Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    body { background: #0d1117; font-family: "Roboto Mono", monospace; }
    .glow { text-shadow: 0 0 10px #00F0FF, 0 0 2px #22d3ee; }
    .neon-border { border: 2px solid #00F0FF; box-shadow: 0 0 24px #00F0FF60; }
    .fancy-panel { background: linear-gradient(135deg,#0d1117 0%,#111b37 100%); }
    .fancy-shadow { box-shadow: 0 6px 32px #00F0FF22 inset;}
    .status-alert { background: #0d1c20; border: 2px solid #00F0FF; box-shadow: 0 0 24px #00F0FF22; }
    .level-glow { color: #00F0FF; text-shadow: 0 0 8px #00F0FF,0 0 2px #22d3ee; }
    .tab-active { background: #0b1726; color: #00F0FF; border-bottom: 3px solid #00F0FF; }
    .tab { color: #dbeafe; }
    .quest-box { border: 1.5px solid #21e6c1; background: #111b37; box-shadow: 0 0 16px #21e6c133; }
    .quest-box.active { border-color: #00F0FF; box-shadow: 0 0 24px #00F0FF22 inset; }
    .btn-neon { background: #00F0FF; color: #111827; font-weight:600; box-shadow: 0 0 12px #00F0FF60;}
    .btn-neon:hover { background: #0cf3ee; }
  </style>
  <script>
    window.firebaseConfig = null; // offline only, paste your config for sync
  </script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    // Utilities, Level/XP logic
    const todayISO = () => new Date().toISOString().slice(0,10);
    const uid = () => Math.random().toString(36).slice(2,10);
    const STORAGE_KEY = "hunter_v2_state";
    const gainXPForTick = streak => (streak>=3?15:10);
    const recomputeLevel = xp => 1+Math.floor(xp/100);
    // Provider (local only)
    const LocalProvider = {
      load: async () => {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          const state = {
            mode: "offline",
            userId: "guest",
            profile: { name: "Hunter", email: "", xp: 0, level: 1 },
            habits: [],   // ** EMPTY! **
            rewards: [
              { id: uid(), name: "Music Break", cost: 20 },
              { id: uid(), name: "Episode Reward", cost: 50 }
            ]
          };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
          return state;
        }
        return JSON.parse(raw);
      },
      save: async state => localStorage.setItem(STORAGE_KEY, JSON.stringify(state))
    };

    async function loadState() {
      let state = await LocalProvider.load();
      state.mode = "offline";
      return state;
    }

    function App() {
      const [state,setState] = React.useState(null);
      const [tab,setTab] = React.useState("STATUS");
      React.useEffect(()=>{ loadState().then(setState); },[]);

      if(!state) return (
        <div className="min-h-screen flex items-center justify-center text-slate-100">
          <div className="text-center">
            <div className="mx-auto mb-6 h-10 w-10 rounded-full border-4 border-cyan-400/30 border-t-cyan-400 animate-spin"></div>
            <div className="level-glow text-lg">SYSTEM INITIALIZING…</div>
            <div className="text-slate-400 mt-2">Preparing UI</div>
          </div>
        </div>
      );

      const save = async (next) => { setState(next); await LocalProvider.save(next); };

      const toggleToday = (habitId) => {
        const t = todayISO();
        const next = structuredClone(state);
        const h = next.habits.find(x=>x.id===habitId); if(!h) return;
        const had = h.logs.includes(t);
        if(had) {
          h.logs = h.logs.filter(x=>x!==t);
          next.profile.xp = Math.max(0,next.profile.xp-gainXPForTick(h.streak));
          next.profile.level = recomputeLevel(next.profile.xp);
        } else {
          h.logs.push(t);
          let streak=0, days=new Set(h.logs);
          for(let i=0;;i++){const d=new Date(); d.setDate(d.getDate()-i);
            const iso=d.toISOString().slice(0,10);if(days.has(iso))streak++;else break;}
          h.streak=streak;
          next.profile.xp += gainXPForTick(streak);
          next.profile.level = recomputeLevel(next.profile.xp);
        }
        save(next);
      };

      const addHabit = (name) => {
        if(!name || !name.trim()) return;
        const next = structuredClone(state);
        next.habits.push({id:uid(),name:name.trim(),logs:[],streak:0});
        save(next);
      };

      return (
        <div className="min-h-screen text-slate-100 fancy-panel">
          <div className="max-w-4xl mx-auto pt-8 px-2">
            {/* Header */}
            <div className="flex justify-between items-center mb-6">
              <div>
                <div className="font-bold text-xl tracking-[.23em] glow">HUNTER SYSTEM V2.0</div>
                <div className="text-slate-400 text-xs">Mode: {state.mode.toUpperCase()} • User: {state.userId}</div>
              </div>
              <div className="flex gap-2">
                {["STATUS","DAILY QUESTS","REWARDS"].map(t=>(
                  <button key={t}
                          onClick={()=>setTab(t)}
                          className={`px-4 py-2 rounded-t font-bold glow transition ${tab===t?'tab-active':'tab'}`}>{t}</button>
                ))}
              </div>
            </div>

            {/* Panels */}
            {tab==="STATUS" && (
              <div className="my-8 space-y-6">
                <div className="status-alert rounded-lg px-4 py-3">
                  <div className="text-xs text-[#22d3ee] mb-1">SYSTEM ALERT</div>
                  <div className="text-lg font-mono glow">{
                      (()=>{
                        const h=new Date().getHours();
                        const t=h<12?"Good Morning":h<18?"Good Afternoon":"Good Evening";
                        return `${t}, Hunter ${state.profile.name}! Daily Quests await.`;
                      })()
                    }</div>
                </div>
                <div className="fancy-panel neon-border rounded-lg shadow-lg p-5 mt-2">
                  <div className="level-glow text-3xl font-extrabold mb-1">LEVEL {state.profile.level}</div>
                  <div className="text-xs text-slate-400 mb-2">Novice Hunter</div>
                  <div className="mb-2 text-slate-200 font-mono">Progress to next level</div>
                  <div className="w-full bg-slate-800 rounded-full h-3 shadow-inner mb-3 relative">
                    <div className="bg-[#00F0FF] rounded-full h-3 transition-all fancy-shadow" style={{width:`${(state.profile.xp%100)}%`}}></div>
                  </div>
                  <div className="text-xs text-slate-400">EXP: {state.profile.xp} | {100-(state.profile.xp%100)} EXP TO LEVEL {state.profile.level+1}</div>
                </div>
              </div>
            )}

            {tab==="DAILY QUESTS" && (
              <div className="my-8 space-y-8">
                <div className="bg-slate-800/80 neon-border rounded-lg p-5 shadow-md mb-4">
                  <div className="text-sm text-slate-300 mb-4 font-mono">Create a new Quest (100% personalized)</div>
                  <AddForm onAdd={addHabit}/>
                </div>
                <div className="grid gap-5">
                  {state.habits.length===0 && (
                    <div className="text-slate-400 text-center py-10">No quests yet. Add your first daily quest above!</div>
                  )}
                  {state.habits.map(h=>(
                    <div key={h.id} className={`quest-box ${h.logs.includes(todayISO())?'active':''} rounded-lg px-6 py-4 flex flex-col gap-1`}>
                      <div className="font-mono text-lg glow">{h.name}</div>
                      <div className="text-xs text-slate-400">Streak: {h.streak}</div>
                      <button className="mt-2 px-4 py-2 btn-neon rounded transition" onClick={()=>toggleToday(h.id)}>
                        {h.logs.includes(todayISO())?"✔ DONE":"Mark Done"}
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {tab==="REWARDS" && (
              <div className="my-8 space-y-8">
                <div className="bg-slate-800/80 neon-border rounded-lg p-5 shadow-md">
                  <div className="text-sm text-slate-300 mb-4 font-mono">Rewards for XP spent</div>
                  <div className="grid gap-4">
                    {state.rewards.map(r=>
                      <div key={r.id} className="p-4 rounded bg-[#0d171f] border border-[#00F0FF] shadow-lg space-y-3">
                        <div className="font-mono text-cyan-300 glow">{r.name}</div>
                        <div className="text-xs text-slate-400">Cost: {r.cost} XP</div>
                        <button disabled={state.profile.xp < r.cost}
                                className={`btn-neon mt-1 px-4 py-2 rounded ${state.profile.xp < r.cost?'opacity-50 cursor-not-allowed':''}`}
                                onClick={()=>{save({...state,profile:{...state.profile,xp: state.profile.xp-r.cost}});}}>
                          Redeem
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    function AddForm({onAdd}) {
      const [name,setName]=React.useState("");
      return (
        <form onSubmit={e=>{e.preventDefault();onAdd(name);setName("");}}>
          <div className="flex gap-2">
            <input value={name} onChange={e=>setName(e.target.value)}
                   className="flex-1 px-3 py-2 neon-border rounded bg-slate-900 text-slate-100 focus:outline-none glow"
                   placeholder="Custom quest name"/>
            <button className="px-4 py-2 btn-neon rounded">Add</button>
          </div>
        </form>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
